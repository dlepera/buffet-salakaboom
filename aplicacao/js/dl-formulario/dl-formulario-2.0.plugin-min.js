var MASK_TELEFONE="(##) ####-####";var MASK_CELULAR=MASK_TELEFONE;var MASK_CELULAR_9="(##) # ####-####";var MASK_RG="##.###.###-#";var MASK_CPF="###.###.###-##";var MASK_CNPJ="##.###.###/####-##";var MASK_CEP="#####-###";var MASK_DATA="##/##/####";var MASK_HORA="##:##";var MASK_DATA_E_HORA=MASK_DATA+" "+MASK_HORA;var EXPR_TELEFONE=/^\([0-9]{2}\)\s{1}[2-5]{1}[0-9]{3}\-{1}[0-9]{4}$/;var EXPR_CELULAR=/^\([0-9]{2}\)\s{1}[6-9]{1}[0-9]{3}\-{1}[0-9]{4}$/;var EXPR_CELULAR_9=/^\([0-9]{2}\)\s{1}9{1}\s{1}[0-9]{4}\-{1}[0-9]{4}$/;var EXPR_EMAIL=/^([a-zA-z\d\._-]*)\@([a-z\d\.-]*)\.([a-z]{2,3})/;var EXPR_RG=/^[0-9]{2}\.{1}[0-9]{3}\.{1}[0-9]{3}\-{1}[0-9Xx]{1}$/;var EXPR_CPF=/^[0-9]{3}\.{1}[0-9]{3}\.[0-9]{3}\-{1}[0-9]{2}$/;var EXPR_CNPJ=/^[0-9]{2}\.{1}[0-9]{3}\.[0-9]{3}\/{1}[0-9]{4}\-{1}[0-9]{2}$/;var EXPR_CEP=/^[0-9]{5}\-{1}[0-9]{3}$/;var EXPR_DATA=/^[0-3]{1}[0-9]{1}\/{1}[0-1]{1}[0-9]{1}\/{1}[0-9]{4}$/;var EXPR_HORA=/^[0-2]{1}[0-9]{1}\:{1}[0-5]{1}[0-9]{1}$/;var EXPR_DATA_E_HORA=/^[0-3]{1}[0-9]{1}\/{1}[0-1]{1}[0-9]{1}\/{1}[0-9]{4}\S{1}[0-2]{1}[0-9]{1}\:{1}[0-5]{1}[0-9]{1}$/;var EXPR_APENAS_NUMEROS=/^\d*$/;var EXPR_APENAS_LETRAS=/^\w*$/;var EXPR_MOEDA_BRL=/^[0-9]*,[0-9]{2}$/;var tempo_msg=new Object();function TratarResposta(r){var r=r.trim();if(/^[?\[{]{1,}(.+)[}\]{1,}]?$/.test(r)){var json=$.parseJSON(r);json=/^\[/.test(r)?json[json.length-1]:json;var mensagem=json.mensagem;var retorno=json.tipo}else{var mensagem=r;var retorno="atencao"}return{msg:mensagem,ret:retorno}}(function($){$.fn._dlformulario=function(opcoes){if($(this)[0].tagName!=="FORM"){alert("O plugin _dlfomulario só pode ser utilizado em formulários.\nEx.: <form ...>...</form>");return false}var $this=$(this);var padrao={controle:null,aparencia:{tema:"dl-formulario",estilo:"formulario"},antes:function(){return true},depois:function(){return true},campos:{},reset:false,cktodos:[false,":checkbox:first",":checkbox[name^='[]']"]};opcoes=$.extend({},padrao,opcoes);if(opcoes.aparencia!==null){if(typeof(CarregarCSS)==="function"){CarregarCSS(dir_raiz+"/aplicacao/js/dl-formulario/css/"+opcoes.aparencia.tema+"/"+opcoes.aparencia.estilo+".css")}$this.addClass(opcoes.aparencia.tema)}fnc_depois=function(){if(opcoes.reset){this.reset()}return opcoes.depois()};$this.find("input:not(:hidden):not([readonly]), select, textarea").each(function(i){$(this).attr({tabindex:i+1})});$this.bind("reset",function(){history.back()});if(opcoes.cktodos[0]){$selecionador=$(opcoes.cktodos[1]);$selecionaveis=$(opcoes.cktodos[2]);$selecionador.click(function(){$selecionaveis.each(function(){this.checked=$selecionador[0].checked})})}for(var a in opcoes.campos){$this.find("[name='"+a+"']")._dlcampos(opcoes.campos[a])}$this.submit(function(){if(!opcoes.antes()){return false}for(var a in opcoes.campos){if(!$this.find("[name='"+a+"']")._dlvalidacao(opcoes.campos[a])){return false}}var form_acao=$this.attr("action").indexOf("php/")<0?$this.attr("action")+"/"+opcoes.controle:$this.attr("action");if($this.attr("enctype")==="multipart/form-data"&&$this.find(":file").length>0){var form_nome="form_upload_"+$this.attr("name");$this.attr({action:form_acao});if($("iframe[name='"+form_nome+"']").length<1){$(document.createElement("iframe")).attr({name:form_nome}).css({width:0,height:0,visibility:"hidden"}).on("load",function(){var r=eval("$(window."+form_nome+".document).text();");if(r!==""){var resp=TratarResposta(r);$("body")._dlmostrarmsg({mensagem:resp.msg,tipo:["alerta",resp.ret],aparencia:{tema:opcoes.aparencia.tema,estilo:"mensagem"},botao:{texto:"x",funcao:resp.ret==="sucesso"?fnc_depois:function(){return false}}})}}).appendTo($this)}$this.attr({target:form_nome});eval("document."+$this.attr("name")+".submit();")}else{$.ajax({url:form_acao,type:$this.attr("method"),data:$this.serialize(),statusCode:{404:function(){$("body")._dlformulario({mensagem:"Português: 404 - Página não encontrada!<br />English: 404 - Page not found!",tipo:["erro","alerta"],aparencia:{tema:opcoes.aparencia.tema,estilo:"mensagem"},botao:{texto:"x"}})},500:function(){$("body")._dlformulario({mensagem:"Português: 500 - Erro interno do servidor!<br />English: 500 - Internal Server Error!",tipo:["erro","alerta"],aparencia:{tema:opcoes.aparencia.tema,estilo:"mensagem"},botao:{texto:"x"}})}},success:function(r){var resp=TratarResposta(r);$("body")._dlmostrarmsg({mensagem:resp.msg,tipo:["alerta",resp.ret],aparencia:{tema:opcoes.aparencia.tema,estilo:"mensagem"},botao:{texto:"x",funcao:resp.ret==="sucesso"?fnc_depois:function(){return false}}})}})}return false});return $this};$.fn._dlmostrarmsg=function(opcoes){var $this=$(this);var padrao={mensagem:"Português: Mensagem padrão!\nEnglish: Default menssage!",tipo:["alerta","atencao"],tempo:8000,botao:{texto:"Ok",funcao:function(){return true}},aparencia:{tema:"dl-formulario",estilo:"mensagem"},animacao:{mostrar:"para-baixo",ocultar:"para-cima",tempo:"1s"}};opcoes=$.extend({},padrao,opcoes);if(typeof(CarregarCSS)==="function"){CarregarCSS(dir_raiz+"aplicacao/js/dl-formulario/css/"+opcoes.aparencia.tema+"/"+opcoes.aparencia.estilo+".css");CarregarCSS(dir_raiz+"aplicacao/js/dl-formulario/css/"+opcoes.aparencia.tema+"/animacoes.css")}$this.addClass(opcoes.aparencia.tema);if($.inArray("campo",opcoes.tipo)>-1){$("#msg-"+$this.attr("name")).fadeOut("fast",function(){$(this).remove()})}var id_unico=$("div.dl-formulario-mensagem").length;var $div=$(document.createElement("div")).addClass("dl-formulario-mensagem "+opcoes.aparencia.tema+" "+opcoes.tipo.join(" ")).css({"-webkit-animation-name":opcoes.animacao.mostrar,"-webkit-animation-duration":opcoes.animacao.tempo,"-webkit-animation-fill-mode":"forwards"}).attr({id:$.inArray("campo",opcoes.tipo)>-1?"msg-"+$this.attr("name"):id_unico});var campos=["INPUT","TEXTAREA","SELECT","BUTTON"];$.inArray(this[0].tagName,campos)>-1?$div.insertAfter($this):$div.appendTo($this);var $p=$(document.createElement("p")).html(opcoes.mensagem).appendTo($div);var $botao=$(document.createElement("button")).attr({type:"button"}).click(function(){clearTimeout(tempo_msg[id_unico]);$div.css({"-webkit-animation-name":opcoes.animacao.ocultar,"-webkit-animation-duration":opcoes.animacao.tempo,"-webkit-animation-fill-mode":"forwards"});setTimeout(function(){return $div.remove()},opcoes.animacao.tempo.replace(/[^0-9]/g,"")*1000);$("button[type='submit']:disabled").removeAttr("disabled");return opcoes.botao.funcao!==undefined?opcoes.botao.funcao():true}).text(opcoes.botao.texto).appendTo($p);tempo_msg[id_unico]=window.setTimeout(function(){return $botao.trigger("click")},opcoes.tempo);return $this};$.fn._dlcampos=function(opcoes){var $this=$(this);var padrao={apelido:$this.attr("title"),obr:false,marcarobr:true,mascara:null,validacao:null};opcoes=$.extend({},padrao,opcoes);if(opcoes.mascara!==null){this.defaultValue=opcoes.mascara.replace(/#/g,"_");if($this.attr("value")===""){$this.val(this.defaultValue)}$this.attr("maxlength",opcoes.mascara.length+1)}if(opcoes.obr&&opcoes.marcarobr){$span=$(document.createElement("span")).css("color","red").html("*");$label=$this.parents("label").length>0?$this.parents("label"):$("label[for='"+$this.attr("name")+"']");if($label.length>0){$span.appendTo($label)}else{$span.insertAfter($this)}}$this.keyup(function(){if(opcoes.mascara!==null){var $_this=$(this);var valor_mascara_i=opcoes.mascara.replace(/#/g,"_");var valor_limpo=$_this.val().replace(/[^A-Z^a-z^0-9]/g,"");var num=valor_limpo.length;for(var i=0;i<num;i++){valor_mascara_i=valor_mascara_i.replace("_",valor_limpo[i])}$_this.val(valor_mascara_i);var cursor=$_this.val().indexOf("_");if(cursor>-1){MoverCursor(this,cursor)}}}).blur(function(){return $(this)._dlvalidacao({apelido:opcoes.apelido,obr:opcoes.obr,validacao:opcoes.validacao,mascara:opcoes.mascara})});return $this};$.fn._dlvalidacao=function(opcoes){var $this=$(this);var padrao={apelido:$this.attr("title"),obr:false,mascara:null,validacao:null};opcoes=$.extend({},padrao,opcoes);if($this.is(":disabled")){return true}var valor=$this.val();if(opcoes.mascara!==null){valor=valor.replace(opcoes.mascara.replace(/#/g,"_"),"")}var coord=$this.position();if(opcoes.obr&&valor===""){window.scrollTo(0,coord.top-100);$this._dlmostrarmsg({mensagem:"O campo <b>"+opcoes.apelido+"</b> é obrigatório!<br />Por favor preencha corretamente.",tipo:["campo","erro"],botao:{texto:"x"},animacao:{mostrar:"fadein",ocultar:"fadeout",tempo:"1s"},aparencia:{tema:"colorido",estilo:"mensagem"}});return false}if(opcoes.validacao!==null){if(valor!=""&&!opcoes.validacao.test(valor)){window.scrollTo(0,coord.top-100);$this._dlmostrarmsg({mensagem:"O campo <b>"+opcoes.apelido+"</b> não obecece o formato necessário.<br />Por favor preencha corretamente.",tipo:["campo","erro"],botao:{texto:"x"},animacao:{mostrar:"fadein",ocultar:"fadeout",tempo:"1s"},aparencia:{tema:"colorido",estilo:"mensagem"}});return false}}$this.find("+.dl-formulario-mensagem").fadeOut("fast",function(){$(this).remove()});return $this}})(jQuery);